## Linux containers on Windows host
1. Clone the repo and navigate to its root folder
```sh
cd .\DotnetWebAppWithCompose\
```
2. Generate cert and configure local machine:
```sh
mkdir -p $env:USERPROFILE\.aspnet\https\
dotnet dev-certs https -ep $env:USERPROFILE\.aspnet\https\WebFrontEnd.pfx -p <CREDENTIAL_PLACEHOLDER>
dotnet dev-certs https --trust
```
3. Configure application secrets, for the certificate:
```sh
dotnet user-secrets -p .\WebFrontEnd\WebFrontEnd.csproj set "Kestrel:Certificates:Development:Password" <CREDENTIAL_PLACEHOLDER>
```
> [!NOTE]
> The password must match the password used for the certificate.
5. Start services using `docker compose`:
```sh
docker compose up -d
```
> [!NOTE]
> webfrontend service by default [mounts](https://github.com/brych126/DotnetWebAppWithCompose/blob/main/docker-compose.override.yml#L10-L13) previously created TLS cerificate needed for `https` work from the host.
> When you try to launch services via Visual Studio then it will run your services by executing the next command: `docker compose  -f "<Full_path_placeholder>\DotnetWebAppWithCompose\docker-compose.yml" -f "<Full_path_placeholder>\DotnetWebAppWithCompose\docker-compose.override.yml" -f "<Full_path_placeholder>\DotnetWebAppWithCompose\obj\Docker\docker-compose.vs.debug.g.yml" -p dockercompose<RandomIdGeneratedByVSPlaceHolder> --ansi never up -d`
> where `docker-compose.vs.debug.g.yml` is generated by VS and overrided certificate location mount path. New path is `${APPDATA}/ASP.NET/Https`
> Accordingly it is certificate created by VS with new password which will overwrite our certificate's password in `usersectes`.
> To prevent this after creating new certificate in step `2` copy it as well to `env:APPDATA/ASP.NET/Https`

## Linux containers on Linux host
1. Clone the repo and navigate to its root folder
```sh
cd DotnetWebAppWithCompose/
```
2. Create a certificate directory with appropriate permissions:
```sh
mkdir -p -m 755 ~/.aspnet/https
mkdir -p -m 755 ~/.microsoft/usersecrets
```
3. Generate cert and configure local machine:
```sh
dotnet dev-certs https -ep ~/.aspnet/https/WebFrontEnd.pfx -p <CREDENTIAL_PLACEHOLDER>
dotnet dev-certs https --trust
```
4. Configure application secrets, for the certificate:
```sh
dotnet user-secrets -p ./WebFrontEnd/WebFrontEnd.csproj set "Kestrel:Certificates:Development:Password" <CREDENTIAL_PLACEHOLDER>
```
> [!NOTE]
> The password must match the password used for the certificate.
5. Change permissions for created files:
```sh
sudo chmod 755 -R  ~/.aspnet/
sudo chmod 755 -R  ~/.microsoft/
```
6.  Update `.env` file by replacing old value for `COMPOSE_FILE` env variable with new one `COMPOSE_FILE=docker-compose.yml:docker-compose.override.yml:docker-compose.healthcheck.yml:docker-compose-linux.override.yml`.
`docker-compose-linux.override.yml` file has been added to the list of docker compose yaml files. It is needed because it contains overrides for certificate mount paths for linux host.
7. Start services using `docker compose`:
```sh
docker compose up -d
```
   
